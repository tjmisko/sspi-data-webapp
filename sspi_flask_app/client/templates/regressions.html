{% extends 'layout.html' %}

{% block title %}
<title>Series Regression Analysis</title>
{% endblock %}

{% block content %}
<article class="page-content">
    <section class="page-section">
        <div class="content-container">
            <div class="page-header">
                <h2>Series Correlation Analysis</h2>
                <p class="functionality-explainer">
                    Explore relationships between different indicators, categories, pillars, and datasets
                    using multiple statistical analysis modes.
                </p>
            </div>

            <div id="correlation-chart-root"></div>

            <div class="methodology-section">
                <h2>Analysis Modes</h2>

                <div class="mode-description">
                    <h3>Year-by-Year Cross-Sectional</h3>
                    <p>
                        Examines the correlation within a single year across countries.
                        Use the year slider to see how the relationship evolves over time.
                        Controls for temporal effects but requires sufficient cross-sectional variation.
                    </p>
                </div>

                <div class="mode-description">
                    <h3>Lagged First Differences</h3>
                    <p>
                        Analyzes the relationship between changes (Δx, Δy) from year to year.
                        Centered on the origin. Helps identify whether changes in one variable
                        are associated with changes in another, controlling for country-specific
                        fixed effects.
                    </p>
                </div>

                <div class="mode-description">
                    <h3>Pooled Correlation</h3>
                    <p>
                        Combines all data points across all years and countries,
                        ignoring temporal structure. Provides a simple overall
                        correlation measure but may be misleading if the relationship
                        changes over time.
                    </p>
                </div>
            </div>
        </div>
    </section>
</article>

<script>
window.addEventListener('load', () => {
    const params = new URLSearchParams(window.location.search);
    try {
        const chart = new SeriesCorrelationChart(
            document.getElementById('correlation-chart-root'),
            {
                initialSeriesX: params.get('seriesX') || '',
                initialSeriesY: params.get('seriesY') || '',
                colorProvider: SSPIColors
            }
        );
        window.SSPICharts = window.SSPICharts || [];
        window.SSPICharts.push(chart);
    } catch (error) {
        console.error('Failed to initialize correlation chart:', error);
        document.getElementById('correlation-chart-root').innerHTML =
            '<div class="error-message">Failed to load correlation chart. Please try again.</div>';
    }
});
</script>
{% endblock %}
