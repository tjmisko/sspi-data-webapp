{% extends 'layout.html' %}

{% block title %}
<title> SSPI Data for {{ cdetail.Country }} ({{ cdetail.CountryCode | upper }}) </title>
{% endblock title %}


{% block content %}
{% if error %}
    <div class="alert alert-danger" role="alert">
        <strong>Error:</strong> No Country {{ CountryCode }} found!
    </div>
{% else %}
    <section class="page-section">
        <div class="content-container">
            <div class="country-overview-box">
                <div class="country-header">
                    <div class="country-selector-container">
                        <select id="country-selector" class="country-selector">
                            {% for country in country_list %}
                            <option
                                value="{{ country.Metadata.CountryCode }}"
                                {% if country.Metadata.CountryCode == cdetail.CountryCode %}selected{% endif %}>
                                {{ country.Metadata.Flag }} {{ country.Metadata.Country }} ({{ country.Metadata.CountryCode }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                {% include 'components/country-characteristics-summary.html' %}
            </div>
            <div class="country-overview-box">
                <h3>Pillar Score Breakdown</h3>
                <p> The overall SSPI score is computed as the arithmetic
                average of the Sustainability, Market Structure, and Public
                Goods Pillars. The Pillar Score Breakdown below shows the
                relative contributions of the three pillars to the overall score
                over time.</p>
                <div class="country-pillar-chart-container" id="pillar-breakdown-chart"></div>
            </div>
            <div class="country-overview-box">
                <h3>Category Score Breakdown</h3>
                <p> The Category Score Breakdown shows the
                category scores for a given year. Use the year
                slider below to scrub through years of
                interest.</p>
                <div id="category-radar-chart"></div>
            </div>
            <div class="country-overview-box">
                <h3>Indicator Performance</h3>
                <p></p>
                <div id="category-radar-chart"></div>
            </div>
            <div class="country-overview-box">
                <h3>Data Coverage and Imputations</h3>
            <p>The SSPI uses the best available data to generate
                policy scores. Where data availability presents
                challenges, we use imputations and data modelling
                to make scores as commensurable across countries
                and years as possible. </p>
                <div id="category-radar-chart"></div>
            </div>
        </div>
    </section>
    <script>
        const countryDetail = {
            "Flag": "{{ cdetail.Flag }}",
            "Country": "{{ cdetail.Country }}",
            "CCode": "{{ cdetail.CountryCode }}"
        };
        window.addEventListener("load", (event) => {
            // Country selector navigation
            const countrySelector = document.getElementById('country-selector');
            if (countrySelector) {
                countrySelector.addEventListener('change', (e) => {
                    const selectedCountryCode = e.target.value;
                    window.location.href = `/data/country/${selectedCountryCode}`;
                });
            }

            window.SSPICharts.push(
                new CountryPillarPanelChart(document.getElementById("pillar-breakdown-chart"), "{{ cdetail.CountryCode | upper}}", "SSPI", { colorProvider: SSPIColors }, countryDetail)
            );

            window.SSPICharts.push(
                new CategoryRadarDynamic("{{ cdetail.CountryCode | upper}}", document.getElementById("category-radar-chart"))
            );

            const x = window.observableStorage.getItem('windowX');
            const y = window.observableStorage.getItem('windowY');

            if (x !== null && y !== null && !String(location).includes("#")) {
              console.log("Scrolling")
              window.moveTo(parseInt(x), parseInt(y));
            }
        })
        window.addEventListener('beforeunload', () => {
          window.observableStorage.setItem('windowX', window.screenX);
          window.observableStorage.setItem('windowY', window.screenY);
        });
    </script>
{% endif %}
{% endblock content %}
